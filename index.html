<script>
  async function payCrypto() {
    const link = document.getElementById("youtubeLink").value.trim();
    const quantity = subsRange.value;
    const priceUSD = (quantity * 0.005).toFixed(2);

    if (!link) {
      alert("Please enter your YouTube channel link.");
      return;
    }

    const orderId = "luxsub_" + Math.floor(Math.random() * 999999);
    const successUrl = `${window.location.origin}/success.html?quantity=${quantity}&link=${encodeURIComponent(link)}&price=${priceUSD}`;

    const body = {
      price_amount: parseFloat(priceUSD),
      price_currency: "usd",
      pay_currency: "usdttrc20",
      order_id: orderId,
      order_description: `YT Subs: ${quantity} for ${link}`,
      success_url: successUrl
    };

    try {
      const resp = await fetch("https://api.nowpayments.io/v1/payment", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "x-api-key": "G565V4C-PQDMPEQ-KJ7PS0M-9Y57WMF"
        },
        body: JSON.stringify(body)
      });
      const data = await resp.json();
      if (data.payment_url) window.location.href = data.payment_url;
      else throw new Error(JSON.stringify(data));
    } catch (e) {
      alert("Payment error. Check console.");
      console.error(e);
    }
  }
</script>
